<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· ÎšÎ±Î¹ÏÎ¿Ï - Î‘Î¯Î³Î¹Î½Î± & ÎœÏ€ÏÎ¬Î»Î¿Ï‚</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .weather-card { border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); transition: transform 0.3s ease; }
        .weather-card:hover { transform: translateY(-5px); }
        .aegina-card { border-left: 5px solid #17a2b8; }
        .mpralos-card { border-left: 5px solid #28a745; }
        .weather-icon { font-size: 4rem; margin-bottom: 10px; }
        .temp-display { font-size: 3rem; font-weight: bold; }
        .weather-details { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .weather-detail-item { background: #f8f9fa; padding: 10px; border-radius: 8px; text-align: center; }
        .weather-detail-item i { font-size: 1.5rem; margin-bottom: 5px; display: block; }
        .loading-spinner { display: flex; justify-content: center; align-items: center; min-height: 150px; }
        .day-rating { padding: 5px 15px; border-radius: 20px; font-weight: bold; }
        .rating-excellent { background: #28a745; color: white; }
        .rating-good { background: #20c997; color: white; }
        .rating-moderate { background: #ffc107; color: black; }
        .rating-poor { background: #fd7e14; color: white; }
        .rating-bad { background: #dc3545; color: white; }
        .watering-yes { color: #28a745; font-weight: bold; }
        .watering-no { color: #dc3545; font-weight: bold; }
        .best-aegina { color: #17a2b8; font-weight: bold; }
        .best-mpralos { color: #28a745; font-weight: bold; }
        .best-tie { color: #6c757d; font-weight: bold; }
        .forecast-card { border-radius: 10px; padding: 15px; text-align: center; margin: 5px; min-width: 120px; background: #fff; border: 1px solid #ddd; }
        .forecast-card.optimal { border: 3px solid #28a745; background: #d4edda; }
        .forecast-card.good { background: #fff3cd; }
        .forecast-card.avoid { background: #f8d7da; }
        .stat-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
        .stat-item:last-child { border-bottom: none; }
        .weather-classification { display: inline-block; padding: 3px 10px; border-radius: 15px; font-size: 0.85rem; font-weight: 500; }
        .class-sunny { background: #fff3cd; color: #856404; }
        .class-cloudy { background: #e2e3e5; color: #383d41; }
        .class-rainy { background: #cce5ff; color: #004085; }
        .class-stormy { background: #d4edda; color: #155724; }
        .class-snowy { background: #f8f9fa; color: #495057; }
        .plant-recommendation { padding: 20px; border-radius: 15px; margin: 10px 0; }
        .plant-recommendation.water-now { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; }
        .plant-recommendation.water-later { background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); color: white; }
        .plant-recommendation.no-water { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; }
        .recommendation-icon { font-size: 3rem; margin-bottom: 10px; }
        .plant-card { border-radius: 10px; padding: 12px; margin: 8px 0; border-left: 4px solid; }
        .plant-card.water-yes { border-color: #28a745; background: #d4edda; }
        .plant-card.water-no { border-color: #dc3545; background: #f8d7da; }
        .plant-card.water-caution { border-color: #ffc107; background: #fff3cd; }
        .plant-icon { font-size: 1.5rem; margin-right: 10px; }
        .plant-status { font-weight: bold; }
        .plant-status.yes { color: #28a745; }
        .plant-status.no { color: #dc3545; }
        .plant-status.caution { color: #856404; }
        .grandma-card { border: 3px solid #e83e8c; border-radius: 15px; }
        .grandma-header { background: linear-gradient(135deg, #e83e8c 0%, #6f42c1 100%); }
        .location-recommendation { padding: 20px; border-radius: 15px; text-align: center; }
        .location-recommendation.aegina-rec { background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%); color: white; }
        .location-recommendation.mpralos-rec { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; }
        .location-recommendation.warning-rec { background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); color: white; }
        .health-score { font-size: 2.5rem; font-weight: bold; }
        .health-factor { padding: 8px 12px; margin: 4px; border-radius: 20px; display: inline-block; font-size: 0.85rem; }
        .factor-good { background: #d4edda; color: #155724; }
        .factor-bad { background: #f8d7da; color: #721c24; }
        .factor-warning { background: #fff3cd; color: #856404; }
        .travel-card { border-radius: 10px; padding: 15px; margin: 8px 0; }
        .travel-card.recommended { background: #d4edda; border-left: 4px solid #28a745; }
        .travel-card.not-recommended { background: #f8d7da; border-left: 4px solid #dc3545; }
        .travel-card.neutral { background: #e2e3e5; border-left: 4px solid #6c757d; }
        .boat-card { border-radius: 10px; padding: 15px; margin-top: 15px; }
        .boat-safe { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; }
        .boat-caution { background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); color: white; }
        .boat-danger { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; }
        .sea-indicator { display: inline-block; padding: 5px 12px; border-radius: 15px; margin: 3px; font-size: 0.85rem; }
        @media (max-width: 768px) { .temp-display { font-size: 2rem; } .weather-icon { font-size: 3rem; } .weather-details { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container">
            <span class="navbar-brand mb-0 h1"><i class="bi bi-cloud-sun"></i> Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· ÎšÎ±Î¹ÏÎ¿Ï</span>
            <span class="navbar-text text-white" id="currentDate"></span>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card weather-card aegina-card">
                    <div class="card-header bg-info text-white">
                        <h4><i class="bi bi-geo-alt"></i> Î‘Î¯Î³Î¹Î½Î±</h4>
                        <small>37.754337, 23.459760 | Î¥ÏˆÏŒÎ¼ÎµÏ„ÏÎ¿: 180Î¼</small>
                    </div>
                    <div class="card-body" id="aeginaWeather">
                        <div class="loading-spinner"><div class="spinner-border text-info"></div></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card weather-card mpralos-card">
                    <div class="card-header bg-success text-white">
                        <h4><i class="bi bi-geo-alt"></i> ÎœÏ€ÏÎ¬Î»Î¿Ï‚</h4>
                        <small>38.724759, 22.463558 | Î¥ÏˆÏŒÎ¼ÎµÏ„ÏÎ¿: 330Î¼</small>
                    </div>
                    <div class="card-body" id="mpralosWeather">
                        <div class="loading-spinner"><div class="spinner-border text-success"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-warning"><h5><i class="bi bi-bar-chart"></i> Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· ÎšÎ±Î¹ÏÎ¿Ï Î£Î®Î¼ÎµÏÎ±</h5></div>
                    <div class="card-body" id="comparisonSection">
                        <div class="loading-spinner"><div class="spinner-border text-warning"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Grandma Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card grandma-card">
                    <div class="card-header grandma-header text-white">
                        <h5 class="mb-0"><i class="bi bi-heart-pulse"></i> Î Î¿Ï Î˜Î± ÎˆÏ€ÏÎµÏ€Îµ Î½Î± Î•Î¯Î½Î±Î¹ Î· Î“Î¹Î±Î³Î¹Î¬;</h5>
                        <small>Î£Ï…ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Î±ÏƒÎ¸Î¼Î±Ï„Î¹ÎºÎ¿ÏÏ‚ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„Î¿Ï…Ï‚ ÏƒÏ„Î¿ ÎºÏÏÎ¿</small>
                    </div>
                    <div class="card-body" id="grandmaSection">
                        <div class="loading-spinner"><div class="spinner-border text-danger"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card border-info">
                    <div class="card-header bg-info text-white"><h5><i class="bi bi-flower1"></i> Î‘Î¯Î³Î¹Î½Î± - Î ÏŒÏ„Î¹ÏƒÎ¼Î± Î¦Ï…Ï„ÏÎ½</h5></div>
                    <div class="card-body" id="aeginaPlants">
                        <div class="loading-spinner"><div class="spinner-border text-info"></div></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card border-success">
                    <div class="card-header bg-success text-white"><h5><i class="bi bi-flower1"></i> ÎœÏ€ÏÎ¬Î»Î¿Ï‚ - Î ÏŒÏ„Î¹ÏƒÎ¼Î± Î¦Ï…Ï„ÏÎ½</h5></div>
                    <div class="card-body" id="mpralosPlants">
                        <div class="loading-spinner"><div class="spinner-border text-success"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white"><h5><i class="bi bi-calendar-week"></i> Î ÏÏŒÎ²Î»ÎµÏˆÎ· 7 Î—Î¼ÎµÏÏÎ½ - Î’Î­Î»Ï„Î¹ÏƒÏ„Î· Î—Î¼Î­ÏÎ± Î Î¿Ï„Î¯ÏƒÎ¼Î±Ï„Î¿Ï‚</h5></div>
                    <div class="card-body table-responsive" id="forecastSection">
                        <div class="loading-spinner"><div class="spinner-border text-primary"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-journal-text"></i> Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÎšÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ ÎšÎ±Î¹ÏÎ¿Ï</h5>
                        <div>
                            <button class="btn btn-sm btn-outline-light me-2" onclick="exportLog()"><i class="bi bi-download"></i> Î•Î¾Î±Î³Ï‰Î³Î®</button>
                            <button class="btn btn-sm btn-outline-danger" onclick="clearLog()"><i class="bi bi-trash"></i> ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚</button>
                        </div>
                    </div>
                    <div class="card-body table-responsive">
                        <table class="table table-striped table-hover" id="historyTable">
                            <thead class="table-dark">
                                <tr><th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</th><th>Î‘Î¯Î³Î¹Î½Î±</th><th>ÎœÏ€ÏÎ¬Î»Î¿Ï‚</th><th>ÎšÎ±Î»ÏÏ„ÎµÏÎ·</th><th>Î‘Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ·</th><th>Î ÏŒÏ„Î¹ÏƒÎ¼Î±</th></tr>
                            </thead>
                            <tbody id="historyBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-info text-white"><h5><i class="bi bi-trophy"></i> Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬ Î‘Î¯Î³Î¹Î½Î±Ï‚</h5></div>
                    <div class="card-body" id="aeginaStats"><p class="text-muted">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î±</p></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white"><h5><i class="bi bi-trophy"></i> Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬ ÎœÏ€ÏÎ¬Î»Î¿Ï…</h5></div>
                    <div class="card-body" id="mpralosStats"><p class="text-muted">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î±</p></div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-3 mt-4">
        <p class="mb-0"><i class="bi bi-cloud-sun"></i> Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· ÎšÎ±Î¹ÏÎ¿Ï | Î”ÎµÎ´Î¿Î¼Î­Î½Î±: <a href="https://open-meteo.com/" class="text-info" target="_blank">Open-Meteo</a></p>
        <small>Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ·: <span id="lastUpdate">-</span></small>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const LOCATIONS = {
            aegina: { name: 'Î‘Î¯Î³Î¹Î½Î±', lat: 37.754337, lon: 23.459760, elevation: 180 },
            mpralos: { name: 'ÎœÏ€ÏÎ¬Î»Î¿Ï‚', lat: 38.724759, lon: 22.463558, elevation: 330 }
        };

        const WEATHER_CODES = {
            0: { text: 'Î‘Î¯Î¸ÏÎ¹Î¿Ï‚', icon: 'bi-sun', class: 'class-sunny' },
            1: { text: 'ÎšÏ…ÏÎ¯Ï‰Ï‚ Î±Î¯Î¸ÏÎ¹Î¿Ï‚', icon: 'bi-sun', class: 'class-sunny' },
            2: { text: 'ÎœÎµÏÎ¹ÎºÏÏ‚ Î½ÎµÏ†ÎµÎ»ÏÎ´Î·Ï‚', icon: 'bi-cloud-sun', class: 'class-cloudy' },
            3: { text: 'ÎÎµÏ†ÎµÎ»ÏÎ´Î·Ï‚', icon: 'bi-cloud', class: 'class-cloudy' },
            45: { text: 'ÎŸÎ¼Î¯Ï‡Î»Î·', icon: 'bi-cloud-fog', class: 'class-cloudy' },
            48: { text: 'Î Î±Î³Ï‰Î¼Î­Î½Î· Î¿Î¼Î¯Ï‡Î»Î·', icon: 'bi-cloud-fog2', class: 'class-cloudy' },
            51: { text: 'Î•Î»Î±Ï†ÏÏ ÏˆÎ¹Î»ÏŒÎ²ÏÎ¿Ï‡Î¿', icon: 'bi-cloud-drizzle', class: 'class-rainy' },
            53: { text: 'ÎœÎ­Ï„ÏÎ¹Î¿ ÏˆÎ¹Î»ÏŒÎ²ÏÎ¿Ï‡Î¿', icon: 'bi-cloud-drizzle', class: 'class-rainy' },
            55: { text: 'ÎˆÎ½Ï„Î¿Î½Î¿ ÏˆÎ¹Î»ÏŒÎ²ÏÎ¿Ï‡Î¿', icon: 'bi-cloud-drizzle', class: 'class-rainy' },
            61: { text: 'Î•Î»Î±Ï†ÏÎ¹Î¬ Î²ÏÎ¿Ï‡Î®', icon: 'bi-cloud-rain', class: 'class-rainy' },
            63: { text: 'ÎœÎ­Ï„ÏÎ¹Î± Î²ÏÎ¿Ï‡Î®', icon: 'bi-cloud-rain', class: 'class-rainy' },
            65: { text: 'ÎˆÎ½Ï„Î¿Î½Î· Î²ÏÎ¿Ï‡Î®', icon: 'bi-cloud-rain-heavy', class: 'class-rainy' },
            71: { text: 'Î•Î»Î±Ï†ÏÏ Ï‡Î¹ÏŒÎ½Î¹', icon: 'bi-snow', class: 'class-snowy' },
            73: { text: 'ÎœÎ­Ï„ÏÎ¹Î¿ Ï‡Î¹ÏŒÎ½Î¹', icon: 'bi-snow2', class: 'class-snowy' },
            75: { text: 'ÎˆÎ½Ï„Î¿Î½Î¿ Ï‡Î¹ÏŒÎ½Î¹', icon: 'bi-snow3', class: 'class-snowy' },
            80: { text: 'Î•Î»Î±Ï†ÏÎ¹Î­Ï‚ Î¼Ï€ÏŒÏÎµÏ‚', icon: 'bi-cloud-rain', class: 'class-rainy' },
            81: { text: 'ÎœÎ­Ï„ÏÎ¹ÎµÏ‚ Î¼Ï€ÏŒÏÎµÏ‚', icon: 'bi-cloud-rain', class: 'class-rainy' },
            82: { text: 'ÎˆÎ½Ï„Î¿Î½ÎµÏ‚ Î¼Ï€ÏŒÏÎµÏ‚', icon: 'bi-cloud-rain-heavy', class: 'class-rainy' },
            95: { text: 'ÎšÎ±Ï„Î±Î¹Î³Î¯Î´Î±', icon: 'bi-cloud-lightning', class: 'class-stormy' },
            96: { text: 'ÎšÎ±Ï„Î±Î¹Î³Î¯Î´Î± Î¼Îµ Ï‡Î±Î»Î¬Î¶Î¹', icon: 'bi-cloud-lightning-rain', class: 'class-stormy' },
            99: { text: 'ÎˆÎ½Ï„Î¿Î½Î· ÎºÎ±Ï„Î±Î¹Î³Î¯Î´Î±', icon: 'bi-cloud-lightning-rain', class: 'class-stormy' }
        };

        const GREEK_DAYS = ['ÎšÏ…ÏÎ¹Î±ÎºÎ®', 'Î”ÎµÏ…Ï„Î­ÏÎ±', 'Î¤ÏÎ¯Ï„Î·', 'Î¤ÎµÏ„Î¬ÏÏ„Î·', 'Î Î­Î¼Ï€Ï„Î·', 'Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®', 'Î£Î¬Î²Î²Î±Ï„Î¿'];
        const GREEK_MONTHS = ['Î™Î±Î½Î¿Ï…Î±ÏÎ¯Î¿Ï…', 'Î¦ÎµÎ²ÏÎ¿Ï…Î±ÏÎ¯Î¿Ï…', 'ÎœÎ±ÏÏ„Î¯Î¿Ï…', 'Î‘Ï€ÏÎ¹Î»Î¯Î¿Ï…', 'ÎœÎ±ÎÎ¿Ï…', 'Î™Î¿Ï…Î½Î¯Î¿Ï…', 'Î™Î¿Ï…Î»Î¯Î¿Ï…', 'Î‘Ï…Î³Î¿ÏÏƒÏ„Î¿Ï…', 'Î£ÎµÏ€Ï„ÎµÎ¼Î²ÏÎ¯Î¿Ï…', 'ÎŸÎºÏ„Ï‰Î²ÏÎ¯Î¿Ï…', 'ÎÎ¿ÎµÎ¼Î²ÏÎ¯Î¿Ï…', 'Î”ÎµÎºÎµÎ¼Î²ÏÎ¯Î¿Ï…'];
        const HISTORY_KEY = 'weather_history_log';

        // Plant definitions with watering requirements
        const AEGINA_PLANTS = {
            roses: { name: 'Î¤ÏÎ¹Î±Î½Ï„Î¬Ï†Ï…Î»Î»Î±', icon: 'ğŸŒ¹', idealTemp: [15, 28], maxTemp: 35, minHumidity: 40, waterFreq: 'Î¸ÎµÏÎ¼ÏŒ: ÎºÎ±Î¸Î·Î¼ÎµÏÎ¹Î½Î¬, ÎºÏÏÎ¿: 2-3/ÎµÎ²Î´', needsMoreWater: true },
            cactus: { name: 'ÎšÎ¬ÎºÏ„Î¿Î¹', icon: 'ğŸŒµ', idealTemp: [20, 40], maxTemp: 45, minHumidity: 10, waterFreq: 'ÎºÎ¬Î¸Îµ 10-14 Î¼Î­ÏÎµÏ‚', needsMoreWater: false },
            orange: { name: 'Î Î¿ÏÏ„Î¿ÎºÎ±Î»Î¹Î¬', icon: 'ğŸŠ', idealTemp: [15, 30], maxTemp: 38, minHumidity: 30, waterFreq: 'Î¸ÎµÏÎ¼ÏŒ: 2/ÎµÎ²Î´, ÎºÏÏÎ¿: 1/ÎµÎ²Î´', needsMoreWater: true },
            lemon: { name: 'Î›ÎµÎ¼Î¿Î½Î¹Î¬', icon: 'ğŸ‹', idealTemp: [15, 30], maxTemp: 38, minHumidity: 30, waterFreq: 'Î¸ÎµÏÎ¼ÏŒ: 2-3/ÎµÎ²Î´, ÎºÏÏÎ¿: 1/ÎµÎ²Î´', needsMoreWater: true },
            pear: { name: 'Î‘Ï‡Î»Î±Î´Î¹Î¬', icon: 'ğŸ', idealTemp: [10, 25], maxTemp: 35, minHumidity: 40, waterFreq: 'Î¸ÎµÏÎ¼ÏŒ: 2/ÎµÎ²Î´, ÎºÏÏÎ¿: 1/2ÎµÎ²Î´', needsMoreWater: false },
            apple: { name: 'ÎœÎ·Î»Î¹Î¬', icon: 'ğŸ', idealTemp: [10, 25], maxTemp: 32, minHumidity: 40, waterFreq: 'Î¸ÎµÏÎ¼ÏŒ: 2/ÎµÎ²Î´, ÎºÏÏÎ¿: 1/2ÎµÎ²Î´', needsMoreWater: false },
            strawberry: { name: 'Î¦ÏÎ¬Î¿Ï…Î»ÎµÏ‚', icon: 'ğŸ“', idealTemp: [15, 26], maxTemp: 30, minHumidity: 50, waterFreq: 'ÎºÎ±Î¸Î·Î¼ÎµÏÎ¹Î½Î¬ ÏƒÎµ Î¶Î­ÏƒÏ„Î·', needsMoreWater: true },
            avocado: { name: 'Î‘Î²Î¿ÎºÎ¬Î½Ï„Î¿', icon: 'ğŸ¥‘', idealTemp: [18, 30], maxTemp: 35, minHumidity: 40, waterFreq: '2-3/ÎµÎ²Î´, Î²Î±Î¸Ï Ï€ÏŒÏ„Î¹ÏƒÎ¼Î±', needsMoreWater: true }
        };

        const MPRALOS_PLANTS = {
            vegetables: { name: 'Î›Î±Ï‡Î±Î½Î¹ÎºÎ¬', icon: 'ğŸ¥¬', idealTemp: [15, 28], maxTemp: 35, minHumidity: 45, waterFreq: 'ÎºÎ±Î¸Î·Î¼ÎµÏÎ¹Î½Î¬ ÏƒÎµ Î¶Î­ÏƒÏ„Î·', needsMoreWater: true },
            roses: { name: 'Î¤ÏÎ¹Î±Î½Ï„Î¬Ï†Ï…Î»Î»Î±', icon: 'ğŸŒ¹', idealTemp: [15, 28], maxTemp: 35, minHumidity: 40, waterFreq: 'Î¸ÎµÏÎ¼ÏŒ: ÎºÎ±Î¸Î·Î¼ÎµÏÎ¹Î½Î¬, ÎºÏÏÎ¿: 2-3/ÎµÎ²Î´', needsMoreWater: true }
        };

        // Sea/boat travel locations
        const SEA_LOCATIONS = {
            aeginaPort: { name: 'Î›Î¹Î¼Î¬Î½Î¹ Î‘Î¯Î³Î¹Î½Î±Ï‚', lat: 37.745107, lon: 23.424248 },
            saronicGulf: { name: 'Î£Î±ÏÏ‰Î½Î¹ÎºÏŒÏ‚ (Ï€ÏÎ¹Î½ Î ÎµÎ¹ÏÎ±Î¹Î¬)', lat: 37.888070, lon: 23.564009 }
        };

        document.addEventListener('DOMContentLoaded', () => {
            updateCurrentDate();
            loadWeatherData();
            loadHistory();
            updateStatistics();
            setInterval(loadWeatherData, 30 * 60 * 1000);
        });

        function updateCurrentDate() {
            const now = new Date();
            document.getElementById('currentDate').textContent = `${GREEK_DAYS[now.getDay()]}, ${now.getDate()} ${GREEK_MONTHS[now.getMonth()]} ${now.getFullYear()}`;
        }

        async function loadWeatherData() {
            try {
                const [aeginaData, mpralosData, portData, seaData] = await Promise.all([
                    fetchWeather(LOCATIONS.aegina), 
                    fetchWeather(LOCATIONS.mpralos),
                    fetchMarineWeather(SEA_LOCATIONS.aeginaPort),
                    fetchMarineWeather(SEA_LOCATIONS.saronicGulf)
                ]);
                displayWeather('aeginaWeather', aeginaData, 'info');
                displayWeather('mpralosWeather', mpralosData, 'success');
                displayComparison(aeginaData, mpralosData);
                displayGrandmaRecommendation(aeginaData, mpralosData, portData, seaData);
                displayPlantRecommendations('aeginaPlants', aeginaData, AEGINA_PLANTS);
                displayPlantRecommendations('mpralosPlants', mpralosData, MPRALOS_PLANTS);
                displayForecast(aeginaData, mpralosData);
                logTodayWeather(aeginaData, mpralosData);
                updateStatistics();
                document.getElementById('lastUpdate').textContent = new Date().toLocaleString('el-GR');
            } catch (error) {
                console.error('Error:', error);
                ['aeginaWeather', 'mpralosWeather', 'comparisonSection', 'grandmaSection', 'aeginaPlants', 'mpralosPlants', 'forecastSection'].forEach(id => {
                    document.getElementById(id).innerHTML = '<div class="alert alert-danger"><i class="bi bi-exclamation-triangle"></i> Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚</div>';
                });
            }
        }

        async function fetchMarineWeather(location) {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${location.lat}&longitude=${location.lon}&current=wind_speed_10m,wind_direction_10m,wind_gusts_10m&daily=wind_speed_10m_max,wind_direction_10m_dominant,wind_gusts_10m_max&timezone=Europe/Athens&forecast_days=7`;
            const response = await fetch(url);
            if (!response.ok) throw new Error('Marine API error');
            const data = await response.json();
            data.location = location;
            return data;
        }

        async function fetchWeather(location) {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${location.lat}&longitude=${location.lon}&current=temperature_2m,relative_humidity_2m,precipitation,weather_code,wind_speed_10m,wind_direction_10m&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max,wind_speed_10m_max&timezone=Europe/Athens&forecast_days=7`;
            const response = await fetch(url);
            if (!response.ok) throw new Error('API error');
            const data = await response.json();
            data.location = location;
            return data;
        }

        function getWeatherInfo(code) {
            return WEATHER_CODES[code] || { text: 'Î†Î³Î½Ï‰ÏƒÏ„Î¿Ï‚', icon: 'bi-question', class: 'class-cloudy' };
        }

        function displayWeather(elementId, data, color) {
            const c = data.current;
            const w = getWeatherInfo(c.weather_code);
            const dirs = ['Î’', 'Î’Î‘', 'Î‘', 'ÎÎ‘', 'Î', 'ÎÎ”', 'Î”', 'Î’Î”'];
            document.getElementById(elementId).innerHTML = `
                <div class="text-center">
                    <i class="bi ${w.icon} weather-icon text-${color}"></i>
                    <div class="temp-display">${Math.round(c.temperature_2m)}Â°C</div>
                    <span class="weather-classification ${w.class}">${w.text}</span>
                </div>
                <div class="weather-details">
                    <div class="weather-detail-item"><i class="bi bi-droplet text-primary"></i><strong>Î¥Î³ÏÎ±ÏƒÎ¯Î±</strong><div>${c.relative_humidity_2m}%</div></div>
                    <div class="weather-detail-item"><i class="bi bi-cloud-rain text-info"></i><strong>Î’ÏÎ¿Ï‡Î®</strong><div>${c.precipitation} mm</div></div>
                    <div class="weather-detail-item"><i class="bi bi-wind text-secondary"></i><strong>Î†Î½ÎµÎ¼Î¿Ï‚</strong><div>${Math.round(c.wind_speed_10m)} km/h</div></div>
                    <div class="weather-detail-item"><i class="bi bi-compass text-warning"></i><strong>Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·</strong><div>${dirs[Math.round(c.wind_direction_10m / 45) % 8]}</div></div>
                </div>`;
        }

        function displayComparison(aegina, mpralos) {
            const as = calculateDayScore(aegina.current), ms = calculateDayScore(mpralos.current);
            const ar = getDayRating(as), mr = getDayRating(ms);
            const winner = as > ms ? 'Î‘Î¯Î³Î¹Î½Î±' : (ms > as ? 'ÎœÏ€ÏÎ¬Î»Î¿Ï‚' : 'Î™ÏƒÎ¿Ï€Î±Î»Î¯Î±');
            document.getElementById('comparisonSection').innerHTML = `
                <div class="row">
                    <div class="col-md-4"><h6 class="text-center">Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î±</h6><div class="d-flex justify-content-between"><span class="text-info">Î‘Î¯Î³Î¹Î½Î±: ${Math.round(aegina.current.temperature_2m)}Â°C</span><span class="text-success">ÎœÏ€ÏÎ¬Î»Î¿Ï‚: ${Math.round(mpralos.current.temperature_2m)}Â°C</span></div></div>
                    <div class="col-md-4"><h6 class="text-center">Î¥Î³ÏÎ±ÏƒÎ¯Î±</h6><div class="d-flex justify-content-between"><span class="text-info">Î‘Î¯Î³Î¹Î½Î±: ${aegina.current.relative_humidity_2m}%</span><span class="text-success">ÎœÏ€ÏÎ¬Î»Î¿Ï‚: ${mpralos.current.relative_humidity_2m}%</span></div></div>
                    <div class="col-md-4"><h6 class="text-center">Î†Î½ÎµÎ¼Î¿Ï‚</h6><div class="d-flex justify-content-between"><span class="text-info">Î‘Î¯Î³Î¹Î½Î±: ${Math.round(aegina.current.wind_speed_10m)} km/h</span><span class="text-success">ÎœÏ€ÏÎ¬Î»Î¿Ï‚: ${Math.round(mpralos.current.wind_speed_10m)} km/h</span></div></div>
                </div>
                <div class="row mt-3"><div class="col-12 text-center">
                    <h5>Î£Ï…Î½Î¿Î»Î¹ÎºÎ® Î‘Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ·</h5>
                    <div class="row"><div class="col-6"><span class="day-rating ${ar.class}">${ar.text}</span><p class="mt-2 mb-0">Î‘Î¯Î³Î¹Î½Î±: ${as}/100</p></div><div class="col-6"><span class="day-rating ${mr.class}">${mr.text}</span><p class="mt-2 mb-0">ÎœÏ€ÏÎ¬Î»Î¿Ï‚: ${ms}/100</p></div></div>
                    <div class="mt-3"><i class="bi bi-trophy text-warning"></i> <strong>ÎšÎ±Î»ÏÏ„ÎµÏÎ· ÏƒÎ®Î¼ÎµÏÎ±: ${winner}</strong></div>
                </div></div>`;
        }

        function calculateDayScore(c) {
            let s = 100;
            if (c.temperature_2m < 10 || c.temperature_2m > 35) s -= 30;
            else if (c.temperature_2m < 15 || c.temperature_2m > 30) s -= 15;
            if (c.precipitation > 10) s -= 40; else if (c.precipitation > 5) s -= 25; else if (c.precipitation > 1) s -= 10;
            if (c.wind_speed_10m > 50) s -= 30; else if (c.wind_speed_10m > 30) s -= 20; else if (c.wind_speed_10m > 20) s -= 10;
            if (c.relative_humidity_2m > 90 || c.relative_humidity_2m < 20) s -= 15;
            if (c.weather_code >= 95) s -= 30; else if (c.weather_code >= 61) s -= 20; else if (c.weather_code >= 51) s -= 10;
            return Math.max(0, Math.min(100, s));
        }

        function getDayRating(s) {
            if (s >= 80) return { text: 'Î•Î¾Î±Î¹ÏÎµÏ„Î¹ÎºÎ®', class: 'rating-excellent' };
            if (s >= 60) return { text: 'ÎšÎ±Î»Î®', class: 'rating-good' };
            if (s >= 40) return { text: 'ÎœÎ­Ï„ÏÎ¹Î±', class: 'rating-moderate' };
            if (s >= 20) return { text: 'ÎšÎ±ÎºÎ®', class: 'rating-poor' };
            return { text: 'Î Î¿Î»Ï ÎšÎ±ÎºÎ®', class: 'rating-bad' };
        }

        // Grandma health score calculation for asthmatic sensitive to cold
        // Mpralos: wood stove, very warm small house (indoor = good in winter)
        // Aegina: central oil heating, lots of humidity indoors (bad for asthma)
        function calculateGrandmaScore(data, location) {
            const c = data.current;
            const temp = c.temperature_2m;
            const humidity = c.relative_humidity_2m;
            const wind = c.wind_speed_10m;
            const weatherCode = c.weather_code;
            const isMpralos = location === 'mpralos';
            const isAegina = location === 'aegina';
            
            let score = 100;
            let factors = [];

            // INDOOR CONDITIONS FACTOR
            if (isMpralos) {
                // Wood stove = warm & dry indoors, good for asthma in winter
                factors.push({ text: 'ÎÏ…Î»ÏŒÏƒÎ¿Î¼Ï€Î± (Î¶ÎµÏƒÏ„ÏŒ)', class: 'factor-good' });
                score += 10;
                // Less penalty for cold outside since house is warm
                if (temp < 5) { score -= 15; factors.push({ text: 'ÎšÏÏÎ¿ Î­Î¾Ï‰', class: 'factor-warning' }); }
                else if (temp < 10) { score -= 5; factors.push({ text: 'Î”ÏÎ¿ÏƒÎµÏÎ¬ Î­Î¾Ï‰', class: 'factor-warning' }); }
                else if (temp >= 15 && temp <= 26) { score += 10; factors.push({ text: 'Î™Î´Î±Î½Î¹ÎºÎ® Î¸ÎµÏÎ¼.', class: 'factor-good' }); }
                else if (temp > 35) { score -= 20; factors.push({ text: 'Î Î¿Î»Ï Î¶Î­ÏƒÏ„Î·', class: 'factor-warning' }); }
            } else if (isAegina) {
                // Central oil heating + humid environment = bad for asthma
                factors.push({ text: 'Î¥Î³ÏÎ±ÏƒÎ¯Î± ÏƒÏ€Î¹Ï„Î¹Î¿Ï', class: 'factor-bad' });
                score -= 15;
                // Normal temperature factors but outdoor cold still matters
                if (temp < 5) { score -= 30; factors.push({ text: 'Î Î¿Î»Ï ÎºÏÏÎ¿', class: 'factor-bad' }); }
                else if (temp < 10) { score -= 15; factors.push({ text: 'ÎšÏÏÎ¿', class: 'factor-bad' }); }
                else if (temp < 15) { score -= 5; factors.push({ text: 'Î”ÏÎ¿ÏƒÎµÏÎ¬', class: 'factor-warning' }); }
                else if (temp >= 18 && temp <= 26) { score += 15; factors.push({ text: 'Î™Î´Î±Î½Î¹ÎºÎ® Î¸ÎµÏÎ¼.', class: 'factor-good' }); }
                else if (temp > 35) { score -= 20; factors.push({ text: 'Î Î¿Î»Ï Î¶Î­ÏƒÏ„Î·', class: 'factor-warning' }); }
            }

            // Outdoor humidity factors (affects going outside, asthma)
            if (humidity > 80) { score -= 20; factors.push({ text: 'Î¥ÏˆÎ·Î»Î® Ï…Î³ÏÎ±ÏƒÎ¯Î±', class: 'factor-bad' }); }
            else if (humidity > 70) { score -= 10; factors.push({ text: 'Î‘ÏÎºÎµÏ„Î® Ï…Î³ÏÎ±ÏƒÎ¯Î±', class: 'factor-warning' }); }
            else if (humidity < 30) { score -= 10; factors.push({ text: 'ÎÎ·ÏÏŒÏ‚ Î±Î­ÏÎ±Ï‚', class: 'factor-warning' }); }
            else if (humidity >= 40 && humidity <= 60) { score += 5; factors.push({ text: 'ÎšÎ±Î»Î® Ï…Î³ÏÎ±ÏƒÎ¯Î±', class: 'factor-good' }); }

            // Wind factors (asthma)
            if (wind > 40) { score -= 30; factors.push({ text: 'Î˜Ï…ÎµÎ»Î»ÏÎ´Î·Ï‚', class: 'factor-bad' }); }
            else if (wind > 25) { score -= 15; factors.push({ text: 'Î”Ï…Î½Î±Ï„ÏŒÏ‚ Î¬Î½ÎµÎ¼Î¿Ï‚', class: 'factor-warning' }); }
            else if (wind < 15) { score += 5; factors.push({ text: 'Î‰Ï€Î¹Î¿Ï‚ Î¬Î½ÎµÎ¼Î¿Ï‚', class: 'factor-good' }); }

            // Weather conditions
            if (weatherCode >= 95) { score -= 30; factors.push({ text: 'ÎšÎ±Ï„Î±Î¹Î³Î¯Î´Î±', class: 'factor-bad' }); }
            else if (weatherCode >= 71) { score -= 25; factors.push({ text: 'Î§Î¹ÏŒÎ½Î¹', class: 'factor-bad' }); }
            else if (weatherCode >= 61) { score -= 15; factors.push({ text: 'Î’ÏÎ¿Ï‡Î®', class: 'factor-warning' }); }
            else if (weatherCode >= 45) { score -= 20; factors.push({ text: 'ÎŸÎ¼Î¯Ï‡Î»Î·', class: 'factor-bad' }); }
            else if (weatherCode <= 1) { score += 10; factors.push({ text: 'Î‘Î¯Î¸ÏÎ¹Î¿Ï‚', class: 'factor-good' }); }

            return { score: Math.max(0, Math.min(100, score)), factors };
        }

        // Convert wind speed to Beaufort scale
        function windToBeaufort(kmh) {
            if (kmh < 1) return 0;
            if (kmh < 6) return 1;
            if (kmh < 12) return 2;
            if (kmh < 20) return 3;
            if (kmh < 29) return 4;
            if (kmh < 39) return 5;
            if (kmh < 50) return 6;
            if (kmh < 62) return 7;
            if (kmh < 75) return 8;
            if (kmh < 89) return 9;
            if (kmh < 103) return 10;
            if (kmh < 118) return 11;
            return 12;
        }

        // Check if wind is from south (problematic for Aegina port)
        function isSouthWind(degrees) {
            // South is 180Â°, consider 135Â° to 225Â° as "south"
            return degrees >= 135 && degrees <= 225;
        }

        function getBoatRecommendation(portData, seaData) {
            const portWind = portData.current.wind_speed_10m;
            const portDir = portData.current.wind_direction_10m;
            const portGusts = portData.current.wind_gusts_10m;
            const seaWind = seaData.current.wind_speed_10m;
            const seaGusts = seaData.current.wind_gusts_10m;
            
            const portBeaufort = windToBeaufort(portWind);
            const seaBeaufort = windToBeaufort(seaWind);
            const southWind = isSouthWind(portDir);
            
            let status = 'safe';
            let message = 'ÎšÎ‘Î›Î•Î£ Î£Î¥ÎÎ˜Î—ÎšÎ•Î£ Î¤Î‘ÎÎ™Î”Î™ÎŸÎ¥';
            let details = [];
            let warnings = [];

            // Check Saronic Gulf (>4 Beaufort is hard)
            if (seaBeaufort > 5) {
                status = 'danger';
                message = 'ÎœÎ— Î¤Î‘ÎÎ™Î”Î•Î¥Î•Î¤Î•';
                warnings.push(`Î£Î±ÏÏ‰Î½Î¹ÎºÏŒÏ‚: ${seaBeaufort} ÎœÏ€Î¿Ï†ÏŒÏ - Î•Ï€Î¹ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚`);
            } else if (seaBeaufort > 4) {
                status = 'caution';
                message = 'Î”Î¥Î£ÎšÎŸÎ›ÎŸ Î¤Î‘ÎÎ™Î”Î™';
                warnings.push(`Î£Î±ÏÏ‰Î½Î¹ÎºÏŒÏ‚: ${seaBeaufort} ÎœÏ€Î¿Ï†ÏŒÏ - Î”ÏÏƒÎºÎ¿Î»ÎµÏ‚ ÏƒÏ…Î½Î¸Î®ÎºÎµÏ‚`);
            } else if (seaBeaufort >= 4) {
                status = status === 'safe' ? 'caution' : status;
                warnings.push(`Î£Î±ÏÏ‰Î½Î¹ÎºÏŒÏ‚: ${seaBeaufort} ÎœÏ€Î¿Ï†ÏŒÏ - Î£Ï„Î¿ ÏŒÏÎ¹Î¿`);
            }

            // Check Aegina port (south wind = can't moor)
            if (southWind && portBeaufort >= 4) {
                status = 'danger';
                message = 'Î‘Î ÎŸÎ¦Î¥Î“Î•Î¤Î• Î¤Î‘ÎÎ™Î”Î™';
                warnings.push(`Î›Î¹Î¼Î¬Î½Î¹ Î‘Î¯Î³Î¹Î½Î±Ï‚: ÎÏŒÏ„Î¹Î¿Ï‚ Î¬Î½ÎµÎ¼Î¿Ï‚ ${portBeaufort} ÎœÏ€Î¿Ï†ÏŒÏ - Î”ÎµÎ½ Î´Î­Î½Î¿Ï…Î½ Ï€Î»Î¿Î¯Î±`);
            } else if (southWind && portBeaufort >= 3) {
                status = status === 'safe' ? 'caution' : status;
                warnings.push(`Î›Î¹Î¼Î¬Î½Î¹ Î‘Î¯Î³Î¹Î½Î±Ï‚: ÎÏŒÏ„Î¹Î¿Ï‚ Î¬Î½ÎµÎ¼Î¿Ï‚ - Î Î¹Î¸Î±Î½Î¬ Ï€ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î±`);
            }

            // Add general info
            const dirs = ['Î’', 'Î’Î‘', 'Î‘', 'ÎÎ‘', 'Î', 'ÎÎ”', 'Î”', 'Î’Î”'];
            const portDirName = dirs[Math.round(portDir / 45) % 8];
            details.push(`Î›Î¹Î¼Î¬Î½Î¹ Î‘Î¯Î³Î¹Î½Î±Ï‚: ${portBeaufort} ÎœÏ€Î¿Ï†ÏŒÏ, ${portDirName} (${Math.round(portWind)} km/h)`);
            details.push(`Î£Î±ÏÏ‰Î½Î¹ÎºÏŒÏ‚: ${seaBeaufort} ÎœÏ€Î¿Ï†ÏŒÏ (${Math.round(seaWind)} km/h)`);
            
            if (portGusts > portWind * 1.5) {
                details.push(`Î¡Î¹Ï€Î­Ï‚: ${Math.round(portGusts)} km/h`);
            }

            if (status === 'safe') {
                message = seaBeaufort <= 2 ? 'Î‘Î¡Î™Î£Î¤Î•Î£ Î£Î¥ÎÎ˜Î—ÎšÎ•Î£' : 'ÎšÎ‘Î›Î•Î£ Î£Î¥ÎÎ˜Î—ÎšÎ•Î£';
            }

            return { status, message, details, warnings, portBeaufort, seaBeaufort, southWind };
        }

        function displayGrandmaRecommendation(aegina, mpralos, portData, seaData) {
            const aeginaHealth = calculateGrandmaScore(aegina, 'aegina');
            const mpralosHealth = calculateGrandmaScore(mpralos, 'mpralos');
            const boatRec = getBoatRecommendation(portData, seaData);
            
            // Calculate 7-day averages
            const aeginaForecast = calculate7DayHealthScore(aegina);
            const mpralosForecast = calculate7DayHealthScore(mpralos);
            
            // Determine today's recommendation
            let todayRec, todayClass;
            const diff = aeginaHealth.score - mpralosHealth.score;
            if (diff > 15) {
                todayRec = 'Î‘Î™Î“Î™ÎÎ‘';
                todayClass = 'aegina-rec';
            } else if (diff < -15) {
                todayRec = 'ÎœÎ Î¡Î‘Î›ÎŸÎ£';
                todayClass = 'mpralos-rec';
            } else {
                todayRec = mpralosHealth.score >= 50 ? 'ÎœÎ Î¡Î‘Î›ÎŸÎ£' : 'Î‘Î™Î“Î™ÎÎ‘';
                todayClass = mpralosHealth.score >= 50 ? 'mpralos-rec' : 'aegina-rec';
            }

            // Generate travel recommendation
            const travelRec = generateTravelRecommendation(aegina, mpralos, aeginaForecast, mpralosForecast);

            const html = `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="location-recommendation ${aeginaHealth.score > mpralosHealth.score ? 'aegina-rec' : 'mpralos-rec'}" style="${aeginaHealth.score <= mpralosHealth.score ? 'opacity: 0.7' : ''}">
                            <h5><i class="bi bi-geo-alt"></i> Î‘Î¯Î³Î¹Î½Î±</h5>
                            <div class="health-score">${aeginaHealth.score}/100</div>
                            <div class="mt-2">
                                ${aeginaHealth.factors.map(f => `<span class="health-factor ${f.class}">${f.text}</span>`).join('')}
                            </div>
                            <div class="mt-2 small">
                                <i class="bi bi-thermometer"></i> ${Math.round(aegina.current.temperature_2m)}Â°C | 
                                <i class="bi bi-droplet"></i> ${aegina.current.relative_humidity_2m}% | 
                                <i class="bi bi-wind"></i> ${Math.round(aegina.current.wind_speed_10m)} km/h
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="location-recommendation ${mpralosHealth.score > aeginaHealth.score ? 'mpralos-rec' : 'aegina-rec'}" style="${mpralosHealth.score <= aeginaHealth.score ? 'opacity: 0.7' : ''}">
                            <h5><i class="bi bi-geo-alt"></i> ÎœÏ€ÏÎ¬Î»Î¿Ï‚</h5>
                            <div class="health-score">${mpralosHealth.score}/100</div>
                            <div class="mt-2">
                                ${mpralosHealth.factors.map(f => `<span class="health-factor ${f.class}">${f.text}</span>`).join('')}
                            </div>
                            <div class="mt-2 small">
                                <i class="bi bi-thermometer"></i> ${Math.round(mpralos.current.temperature_2m)}Â°C | 
                                <i class="bi bi-droplet"></i> ${mpralos.current.relative_humidity_2m}% | 
                                <i class="bi bi-wind"></i> ${Math.round(mpralos.current.wind_speed_10m)} km/h
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert ${todayClass === 'aegina-rec' ? 'alert-info' : 'alert-success'} text-center">
                    <h5><i class="bi bi-house-heart"></i> Î£Î®Î¼ÎµÏÎ± Î· Î³Î¹Î±Î³Î¹Î¬ Î¸Î± Î­Ï€ÏÎµÏ€Îµ Î½Î± ÎµÎ¯Î½Î±Î¹:</h5>
                    <h3>${todayRec}</h3>
                </div>

                <!-- Boat Travel Section -->
                <div class="boat-card boat-${boatRec.status}">
                    <div class="row align-items-center">
                        <div class="col-md-4 text-center">
                            <i class="bi bi-${boatRec.status === 'safe' ? 'ship' : boatRec.status === 'caution' ? 'exclamation-triangle' : 'x-octagon'}" style="font-size: 2.5rem;"></i>
                            <h5 class="mt-2 mb-0">${boatRec.message}</h5>
                        </div>
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-6">
                                    ${boatRec.details.map(d => `<div class="small"><i class="bi bi-wind"></i> ${d}</div>`).join('')}
                                </div>
                                <div class="col-6">
                                    ${boatRec.warnings.length > 0 ? boatRec.warnings.map(w => `<div class="small"><i class="bi bi-exclamation-circle"></i> ${w}</div>`).join('') : '<div class="small"><i class="bi bi-check-circle"></i> ÎšÎ±Î½Î­Î½Î± Ï€ÏÏŒÎ²Î»Î·Î¼Î±</div>'}
                                </div>
                            </div>
                            <div class="mt-2 small">
                                <span class="sea-indicator ${boatRec.southWind ? 'bg-warning text-dark' : 'bg-light'}">
                                    ${boatRec.southWind ? '<i class="bi bi-arrow-down"></i> ÎÏŒÏ„Î¹Î¿Ï‚' : '<i class="bi bi-check"></i> ÎŒÏ‡Î¹ Î½ÏŒÏ„Î¹Î¿Ï‚'}
                                </span>
                                <span class="sea-indicator ${boatRec.seaBeaufort > 4 ? 'bg-danger' : boatRec.seaBeaufort >= 4 ? 'bg-warning text-dark' : 'bg-success'}">
                                    Î£Î±ÏÏ‰Î½Î¹ÎºÏŒÏ‚: ${boatRec.seaBeaufort} Bf
                                </span>
                                <span class="sea-indicator ${boatRec.portBeaufort > 4 ? 'bg-danger' : boatRec.portBeaufort >= 3 ? 'bg-warning text-dark' : 'bg-success'}">
                                    Î›Î¹Î¼Î¬Î½Î¹: ${boatRec.portBeaufort} Bf
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header bg-secondary text-white">
                        <h6 class="mb-0"><i class="bi bi-calendar-range"></i> Î ÏÏŒÎ²Î»ÎµÏˆÎ· Î•Ï€ÏŒÎ¼ÎµÎ½Ï‰Î½ Î—Î¼ÎµÏÏÎ½ & Î£ÏÏƒÏ„Î±ÏƒÎ· Î¤Î±Î¾Î¹Î´Î¹Î¿Ï</h6>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <strong>Î‘Î¯Î³Î¹Î½Î± (ÎµÏ€ÏŒÎ¼ÎµÎ½ÎµÏ‚ 7 Î¼Î­ÏÎµÏ‚):</strong>
                                <div class="progress mt-1">
                                    <div class="progress-bar bg-info" style="width: ${aeginaForecast.avgScore}%">${aeginaForecast.avgScore}/100</div>
                                </div>
                                <small class="text-muted">Î˜ÎµÏÎ¼: ${aeginaForecast.minTemp}Â° - ${aeginaForecast.maxTemp}Â°C</small>
                            </div>
                            <div class="col-md-6">
                                <strong>ÎœÏ€ÏÎ¬Î»Î¿Ï‚ (ÎµÏ€ÏŒÎ¼ÎµÎ½ÎµÏ‚ 7 Î¼Î­ÏÎµÏ‚):</strong>
                                <div class="progress mt-1">
                                    <div class="progress-bar bg-success" style="width: ${mpralosForecast.avgScore}%">${mpralosForecast.avgScore}/100</div>
                                </div>
                                <small class="text-muted">Î˜ÎµÏÎ¼: ${mpralosForecast.minTemp}Â° - ${mpralosForecast.maxTemp}Â°C</small>
                            </div>
                        </div>
                        ${travelRec}
                    </div>
                </div>
            `;

            document.getElementById('grandmaSection').innerHTML = html;
        }

        function calculate7DayHealthScore(data) {
            const daily = data.daily;
            let totalScore = 0;
            let scores = [];
            
            for (let i = 0; i < daily.time.length; i++) {
                let dayScore = 100;
                const tempMax = daily.temperature_2m_max[i];
                const tempMin = daily.temperature_2m_min[i];
                const avgTemp = (tempMax + tempMin) / 2;
                const precipProb = daily.precipitation_probability_max[i];
                const wind = daily.wind_speed_10m_max[i];
                const weatherCode = daily.weather_code[i];

                // Temperature
                if (avgTemp < 5) dayScore -= 35;
                else if (avgTemp < 10) dayScore -= 20;
                else if (avgTemp < 15) dayScore -= 10;
                else if (avgTemp >= 18 && avgTemp <= 26) dayScore += 10;

                // Precipitation probability
                if (precipProb > 70) dayScore -= 20;
                else if (precipProb > 40) dayScore -= 10;

                // Wind
                if (wind > 40) dayScore -= 25;
                else if (wind > 25) dayScore -= 10;

                // Weather code
                if (weatherCode >= 71) dayScore -= 20;
                else if (weatherCode >= 61) dayScore -= 10;
                else if (weatherCode >= 45) dayScore -= 15;

                scores.push(Math.max(0, Math.min(100, dayScore)));
                totalScore += scores[i];
            }

            return {
                avgScore: Math.round(totalScore / daily.time.length),
                scores: scores,
                minTemp: Math.round(Math.min(...daily.temperature_2m_min)),
                maxTemp: Math.round(Math.max(...daily.temperature_2m_max)),
                days: daily.time
            };
        }

        function generateTravelRecommendation(aegina, mpralos, aeginaForecast, mpralosForecast) {
            const month = new Date().getMonth();
            const isWinter = month >= 10 || month <= 2; // Nov-Feb
            const isSpring = month >= 3 && month <= 4;  // Mar-Apr
            const isSummer = month >= 5 && month <= 8;  // May-Aug
            const isAutumn = month >= 9 && month <= 10; // Sep-Oct

            let recommendation = '';
            let recClass = 'neutral';
            let details = [];

            // Compare forecasts
            const aeginaBetter = aeginaForecast.avgScore > mpralosForecast.avgScore + 10;
            const mpralosBetter = mpralosForecast.avgScore > aeginaForecast.avgScore + 10;
            const coldInMpralos = mpralosForecast.minTemp < 10;
            const niceInAegina = aeginaForecast.minTemp > 12 && aeginaForecast.avgScore > 60;

            if (isWinter) {
                if (coldInMpralos && niceInAegina) {
                    recommendation = 'Î£Î¥ÎÎ™Î£Î¤Î‘Î¤Î‘Î™ Î•Î Î™Î£ÎšÎ•Î¨Î— Î£Î¤Î—Î Î‘Î™Î“Î™ÎÎ‘';
                    recClass = 'recommended';
                    details.push('ÎŸ Ï‡ÎµÎ¹Î¼ÏÎ½Î±Ï‚ ÏƒÏ„Î¿Î½ ÎœÏ€ÏÎ¬Î»Î¿ ÎµÎ¯Î½Î±Î¹ ÎºÏÏÎ¿Ï‚ Î³Î¹Î± Î±ÏƒÎ¸Î¼Î±Ï„Î¹ÎºÎ¿ÏÏ‚');
                    details.push(`Î— Î‘Î¯Î³Î¹Î½Î± Î­Ï‡ÎµÎ¹ Ï€Î¹Î¿ Î®Ï€Î¹Î¿ ÎºÎ»Î¯Î¼Î± (${aeginaForecast.minTemp}Â° - ${aeginaForecast.maxTemp}Â°C)`);
                    details.push('Î™Î´Î±Î½Î¹ÎºÎ® Ï€ÎµÏÎ¯Î¿Î´Î¿Ï‚: 2-3 ÎµÎ²Î´Î¿Î¼Î¬Î´ÎµÏ‚ Ï„Î¿Î½ Ï‡ÎµÎ¹Î¼ÏÎ½Î±');
                } else if (coldInMpralos) {
                    recommendation = 'Î•ÎÎ•Î¤Î‘Î£Î¤Î• Î•Î Î™Î£ÎšÎ•Î¨Î— Î£Î¤Î—Î Î‘Î™Î“Î™ÎÎ‘';
                    recClass = 'recommended';
                    details.push('Î§Î±Î¼Î·Î»Î­Ï‚ Î¸ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯ÎµÏ‚ ÏƒÏ„Î¿Î½ ÎœÏ€ÏÎ¬Î»Î¿');
                }
            } else if (isSpring) {
                if (aeginaBetter && aeginaForecast.avgScore > 65) {
                    recommendation = 'ÎšÎ‘Î›Î— Î Î•Î¡Î™ÎŸÎ”ÎŸÎ£ Î“Î™Î‘ Î‘Î™Î“Î™ÎÎ‘';
                    recClass = 'recommended';
                    details.push('Î— Î¬Î½Î¿Î¹Î¾Î· ÏƒÏ„Î·Î½ Î‘Î¯Î³Î¹Î½Î± ÎµÎ¯Î½Î±Î¹ Î¹Î´Î±Î½Î¹ÎºÎ®');
                    details.push('Î‰Ï€Î¹ÎµÏ‚ Î¸ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯ÎµÏ‚, Î»Î¹Î³ÏŒÏ„ÎµÏÎ· Ï…Î³ÏÎ±ÏƒÎ¯Î±');
                } else {
                    recommendation = 'ÎœÎ ÎŸÎ¡Î•Î™ ÎÎ‘ ÎœÎ•Î™ÎÎ•Î™ ÎœÎ Î¡Î‘Î›ÎŸ';
                    recClass = 'neutral';
                    details.push('ÎšÎ±Î»Î­Ï‚ ÏƒÏ…Î½Î¸Î®ÎºÎµÏ‚ ÎºÎ±Î¹ ÏƒÏ„Î¹Ï‚ Î´ÏÎ¿ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯ÎµÏ‚');
                }
            } else if (isSummer) {
                if (aeginaForecast.maxTemp > 35) {
                    recommendation = 'Î Î¡ÎŸÎ£ÎŸÎ§Î— Î£Î¤Î— Î–Î•Î£Î¤Î—';
                    recClass = 'not-recommended';
                    details.push('Î¥ÏˆÎ·Î»Î­Ï‚ Î¸ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯ÎµÏ‚ ÎºÎ±Î¹ ÏƒÏ„Î¹Ï‚ Î´ÏÎ¿ Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚');
                    details.push('ÎŸ ÎœÏ€ÏÎ¬Î»Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï€Î¹Î¿ Î´ÏÎ¿ÏƒÎµÏÏŒÏ‚');
                } else {
                    recommendation = 'Î•Î Î™Î›ÎŸÎ“Î— ÎœÎ• Î’Î‘Î£Î— Î Î¡ÎŸÎ¤Î™ÎœÎ—Î£Î—';
                    recClass = 'neutral';
                    details.push('Î˜Î¬Î»Î±ÏƒÏƒÎ± ÏƒÏ„Î·Î½ Î‘Î¯Î³Î¹Î½Î± vs Î´ÏÎ¿ÏƒÎ¹Î¬ ÏƒÏ„Î¿Î½ ÎœÏ€ÏÎ¬Î»Î¿');
                }
            } else { // Autumn
                if (aeginaBetter) {
                    recommendation = 'Î™Î”Î‘ÎÎ™ÎšÎ— Î Î•Î¡Î™ÎŸÎ”ÎŸÎ£ Î“Î™Î‘ Î‘Î™Î“Î™ÎÎ‘';
                    recClass = 'recommended';
                    details.push('Î¤Î¿ Ï†Î¸Î¹Î½ÏŒÏ€Ï‰ÏÎ¿ ÏƒÏ„Î·Î½ Î‘Î¯Î³Î¹Î½Î± Î­Ï‡ÎµÎ¹ Î®Ï€Î¹Î¿ ÎºÎ±Î¹ÏÏŒ');
                    details.push('Î ÏÎ¹Î½ Î­ÏÎ¸ÎµÎ¹ Ï„Î¿ ÎºÏÏÎ¿ Ï„Î¿Ï… Ï‡ÎµÎ¹Î¼ÏÎ½Î±');
                } else {
                    recommendation = 'ÎšÎ‘Î›Î‘ ÎšÎ‘Î™ Î£Î¤Î‘ Î”Î¥ÎŸ';
                    recClass = 'neutral';
                }
            }

            // Check immediate forecast (next 7 days)
            const badDaysAegina = aeginaForecast.scores.filter(s => s < 50).length;
            const badDaysMpralos = mpralosForecast.scores.filter(s => s < 50).length;

            if (badDaysMpralos >= 4 && badDaysAegina < 3) {
                recommendation = 'Î Î¡ÎŸÎ¤Î•Î™ÎÎ•Î¤Î‘Î™ Î‘Î™Î“Î™ÎÎ‘ Î‘ÎœÎ•Î£Î‘';
                recClass = 'recommended';
                details.unshift(`${badDaysMpralos} Î´ÏÏƒÎºÎ¿Î»ÎµÏ‚ Î¼Î­ÏÎµÏ‚ ÏƒÏ„Î¿Î½ ÎœÏ€ÏÎ¬Î»Î¿, ${badDaysAegina} ÏƒÏ„Î·Î½ Î‘Î¯Î³Î¹Î½Î±`);
            }

            // Find best days for travel
            let bestDays = [];
            for (let i = 1; i < aeginaForecast.scores.length; i++) {
                if (aeginaForecast.scores[i] > 65 && aeginaForecast.scores[i] > mpralosForecast.scores[i]) {
                    const d = new Date(aeginaForecast.days[i]);
                    bestDays.push(`${GREEK_DAYS[d.getDay()]} ${d.getDate()}/${d.getMonth()+1}`);
                }
            }

            return `
                <div class="travel-card ${recClass}">
                    <h6><i class="bi bi-${recClass === 'recommended' ? 'check-circle' : recClass === 'not-recommended' ? 'x-circle' : 'dash-circle'}"></i> ${recommendation}</h6>
                    <ul class="mb-0 small">
                        ${details.map(d => `<li>${d}</li>`).join('')}
                    </ul>
                    ${bestDays.length > 0 ? `<div class="mt-2"><strong>ÎšÎ±Î»Î­Ï‚ Î¼Î­ÏÎµÏ‚ Î³Î¹Î± Î‘Î¯Î³Î¹Î½Î±:</strong> ${bestDays.slice(0,3).join(', ')}</div>` : ''}
                </div>
            `;
        }

        function displayPlantRecommendations(elementId, weatherData, plants) {
            const c = weatherData.current;
            const d = weatherData.daily;
            const temp = c.temperature_2m;
            const humidity = c.relative_humidity_2m;
            const precip = c.precipitation;
            const precipProb = d.precipitation_probability_max[0] || 0;
            const wind = c.wind_speed_10m;
            const hour = new Date().getHours();
            const isGoodTime = (hour >= 6 && hour <= 9) || (hour >= 18 && hour <= 20);
            const rainExpected = precip > 1 || precipProb > 60;

            let html = '';
            for (const [key, plant] of Object.entries(plants)) {
                const rec = getPlantWateringAdvice(plant, temp, humidity, precip, precipProb, wind, isGoodTime, rainExpected);
                html += `
                    <div class="plant-card ${rec.cardClass}">
                        <div class="d-flex align-items-center">
                            <span class="plant-icon">${plant.icon}</span>
                            <div class="flex-grow-1">
                                <strong>${plant.name}</strong>
                                <div class="small text-muted">Î£Ï…Ï‡Î½ÏŒÏ„Î·Ï„Î±: ${plant.waterFreq}</div>
                            </div>
                            <div class="text-end">
                                <span class="plant-status ${rec.statusClass}">${rec.status}</span>
                                <div class="small">${rec.reason}</div>
                            </div>
                        </div>
                    </div>`;
            }

            const summary = getSummaryRecommendation(temp, humidity, precip, precipProb, wind, isGoodTime);
            html = `<div class="alert ${summary.alertClass} mb-3">
                <i class="bi ${summary.icon}"></i> <strong>${summary.text}</strong>
                <div class="small">${summary.detail}</div>
            </div>` + html;

            document.getElementById(elementId).innerHTML = html;
        }

        function getPlantWateringAdvice(plant, temp, humidity, precip, precipProb, wind, isGoodTime, rainExpected) {
            // Rain expected - no watering needed
            if (rainExpected) {
                return { status: 'ÎŸÎ§Î™', reason: 'Î’ÏÎ¿Ï‡Î®', cardClass: 'water-no', statusClass: 'no' };
            }

            // Too hot - avoid watering during peak heat
            if (temp > plant.maxTemp) {
                return { status: 'Î‘Î ÎŸÎ¦Î¥Î“Î—', reason: 'Î¥Ï€ÎµÏÎ²Î¿Î»Î¹ÎºÎ® Î¶Î­ÏƒÏ„Î·', cardClass: 'water-caution', statusClass: 'caution' };
            }

            // Strong wind - water evaporates quickly
            if (wind > 30) {
                return { status: 'Î‘Î ÎŸÎ¦Î¥Î“Î—', reason: 'Î”Ï…Î½Î±Ï„ÏŒÏ‚ Î¬Î½ÎµÎ¼Î¿Ï‚', cardClass: 'water-caution', statusClass: 'caution' };
            }

            // Cactus special handling
            if (plant.minHumidity <= 10) {
                if (humidity > 60 || temp < 10) {
                    return { status: 'ÎŸÎ§Î™', reason: 'Î‘ÏÎºÎµÏ„Î® Ï…Î³ÏÎ±ÏƒÎ¯Î±', cardClass: 'water-no', statusClass: 'no' };
                }
                if (temp > 25 && humidity < 30) {
                    return { status: 'Î•Î›Î•Î“Î§ÎŸÎ£', reason: 'Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î¿ Ï‡ÏÎ¼Î±', cardClass: 'water-caution', statusClass: 'caution' };
                }
                return { status: 'ÎŸÎ§Î™', reason: 'Î£Ï€Î¬Î½Î¹Î¿ Ï€ÏŒÏ„Î¹ÏƒÎ¼Î±', cardClass: 'water-no', statusClass: 'no' };
            }

            // High water need plants in hot/dry conditions
            if (plant.needsMoreWater && temp > 25 && humidity < plant.minHumidity) {
                if (isGoodTime) {
                    return { status: 'ÎÎ‘Î™', reason: 'Î–Î­ÏƒÏ„Î· + Î¾Î·ÏÎ±ÏƒÎ¯Î±', cardClass: 'water-yes', statusClass: 'yes' };
                }
                return { status: 'Î‘Î¡Î“ÎŸÎ¤Î•Î¡Î‘', reason: `Î Î¿Ï„Î¯ÏƒÏ„Îµ ${new Date().getHours() < 12 ? 'Ï€ÏÏ‰Î¯' : 'Î±Ï€ÏŒÎ³ÎµÏ…Î¼Î±'}`, cardClass: 'water-caution', statusClass: 'caution' };
            }

            // Temperature in ideal range and good time
            if (temp >= plant.idealTemp[0] && temp <= plant.idealTemp[1]) {
                if (isGoodTime && humidity < plant.minHumidity + 20) {
                    return { status: 'ÎÎ‘Î™', reason: 'Î™Î´Î±Î½Î¹ÎºÎ­Ï‚ ÏƒÏ…Î½Î¸Î®ÎºÎµÏ‚', cardClass: 'water-yes', statusClass: 'yes' };
                }
                if (humidity < plant.minHumidity) {
                    return { status: 'Î£Î¥ÎÎ¤ÎŸÎœÎ‘', reason: 'Î§Î±Î¼Î·Î»Î® Ï…Î³ÏÎ±ÏƒÎ¯Î±', cardClass: 'water-caution', statusClass: 'caution' };
                }
            }

            // Cold weather - less watering
            if (temp < plant.idealTemp[0]) {
                return { status: 'Î›Î™Î“ÎŸ', reason: 'ÎšÏÏÎ¿Ï‚ ÎºÎ±Î¹ÏÏŒÏ‚', cardClass: 'water-caution', statusClass: 'caution' };
            }

            // Default - check conditions
            if (isGoodTime) {
                return { status: 'Î•Î›Î•Î“Î§ÎŸÎ£', reason: 'Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î¿ Ï‡ÏÎ¼Î±', cardClass: 'water-caution', statusClass: 'caution' };
            }

            return { status: 'Î‘Î¡Î“ÎŸÎ¤Î•Î¡Î‘', reason: 'ÎšÎ±Î»ÏÏ„ÎµÏÎ± Ï€ÏÏ‰Î¯/Î±Ï€ÏŒÎ³ÎµÏ…Î¼Î±', cardClass: 'water-caution', statusClass: 'caution' };
        }

        function getSummaryRecommendation(temp, humidity, precip, precipProb, wind, isGoodTime) {
            if (precip > 1 || precipProb > 60) {
                return { text: 'ÎœÎ—Î Î ÎŸÎ¤Î™Î£Î•Î¤Î• Î£Î—ÎœÎ•Î¡Î‘', detail: 'Î‘Î½Î±Î¼Î­Î½ÎµÏ„Î±Î¹ Î²ÏÎ¿Ï‡Î®', alertClass: 'alert-danger', icon: 'bi-x-circle' };
            }
            if (temp > 35) {
                return { text: 'Î‘Î ÎŸÎ¦Î¥Î“Î•Î¤Î• Î ÎŸÎ¤Î™Î£ÎœÎ‘', detail: 'Î¥Ï€ÎµÏÎ²Î¿Î»Î¹ÎºÎ® Î¶Î­ÏƒÏ„Î· - Ï€Î¿Ï„Î¯ÏƒÏ„Îµ Î½Ï‰ÏÎ¯Ï‚ Ï€ÏÏ‰Î¯ Î® Î±ÏÎ³Î¬ Î±Ï€ÏŒÎ³ÎµÏ…Î¼Î±', alertClass: 'alert-warning', icon: 'bi-exclamation-triangle' };
            }
            if (wind > 30) {
                return { text: 'Î‘Î ÎŸÎ¦Î¥Î“Î•Î¤Î• Î ÎŸÎ¤Î™Î£ÎœÎ‘', detail: 'Î”Ï…Î½Î±Ï„ÏŒÏ‚ Î¬Î½ÎµÎ¼Î¿Ï‚ - Ï„Î¿ Î½ÎµÏÏŒ ÎµÎ¾Î±Ï„Î¼Î¯Î¶ÎµÏ„Î±Î¹', alertClass: 'alert-warning', icon: 'bi-wind' };
            }
            if (isGoodTime && temp > 20 && humidity < 60) {
                return { text: 'Î™Î”Î‘ÎÎ™ÎšÎ— Î©Î¡Î‘ Î ÎŸÎ¤Î™Î£ÎœÎ‘Î¤ÎŸÎ£', detail: `Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î±: ${Math.round(temp)}Â°C, Î¥Î³ÏÎ±ÏƒÎ¯Î±: ${humidity}%`, alertClass: 'alert-success', icon: 'bi-check-circle' };
            }
            if (temp > 25 && humidity < 50) {
                return { text: 'Î§Î¡Î•Î™Î‘Î–Î•Î¤Î‘Î™ Î ÎŸÎ¤Î™Î£ÎœÎ‘', detail: 'Î–ÎµÏƒÏ„ÏŒÏ‚ ÎºÎ±Î¹ Î¾Î·ÏÏŒÏ‚ ÎºÎ±Î¹ÏÏŒÏ‚', alertClass: 'alert-info', icon: 'bi-droplet' };
            }
            const hour = new Date().getHours();
            if (hour >= 10 && hour <= 17) {
                return { text: 'Î Î•Î¡Î™ÎœÎ•ÎÎ•Î¤Î•', detail: 'ÎšÎ±Î»ÏÏ„ÎµÏÎ± Î½Î± Ï€Î¿Ï„Î¯ÏƒÎµÏ„Îµ Ï€ÏÏ‰Î¯ (6-9) Î® Î±Ï€ÏŒÎ³ÎµÏ…Î¼Î± (18-20)', alertClass: 'alert-secondary', icon: 'bi-clock' };
            }
            return { text: 'Î•Î›Î•Î“ÎÎ¤Î• Î¤Î‘ Î¦Î¥Î¤Î‘', detail: 'ÎšÎ±Î½Î¿Î½Î¹ÎºÎ­Ï‚ ÏƒÏ…Î½Î¸Î®ÎºÎµÏ‚ - Ï€Î¿Ï„Î¯ÏƒÏ„Îµ Î±Î½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹', alertClass: 'alert-info', icon: 'bi-search' };
        }

        function getWateringRecommendation(data) {
            const c = data.current, d = data.daily;
            const rainToday = c.precipitation > 1 || (d.precipitation_probability_max[0] || 0) > 60;
            const rainTomorrow = d.precipitation_probability_max[1] > 60;
            if (rainToday || rainTomorrow) return { text: 'ÎœÎ—Î Î ÎŸÎ¤Î™Î£Î•Î¤Î•', reason: rainToday ? 'Î’ÏÎ¿Ï‡Î® ÏƒÎ®Î¼ÎµÏÎ±' : 'Î’ÏÎ¿Ï‡Î® Î±ÏÏÎ¹Î¿', class: 'no-water', icon: 'bi-x-circle', shouldWater: false };
            if (c.temperature_2m > 35 || c.wind_speed_10m > 30 || c.precipitation > 0) return { text: 'Î‘Î ÎŸÎ¦Î¥Î“Î•Î¤Î•', reason: c.temperature_2m > 35 ? 'Î Î¿Î»Ï Î¶Î­ÏƒÏ„Î·' : 'Î”Ï…Î½Î±Ï„ÏŒÏ‚ Î¬Î½ÎµÎ¼Î¿Ï‚/Î²ÏÎ¿Ï‡Î®', class: 'water-later', icon: 'bi-exclamation-triangle', shouldWater: false };
            if (c.temperature_2m > 25 && c.relative_humidity_2m < 50) return { text: 'Î ÎŸÎ¤Î™Î£Î¤Î• Î£Î—ÎœÎ•Î¡Î‘', reason: `Î–Î­ÏƒÏ„Î· (${Math.round(c.temperature_2m)}Â°C), Ï‡Î±Î¼Î·Î»Î® Ï…Î³ÏÎ±ÏƒÎ¯Î± (${c.relative_humidity_2m}%)`, class: 'water-now', icon: 'bi-check-circle', shouldWater: true };
            const h = new Date().getHours();
            if ((h >= 6 && h <= 9) || (h >= 18 && h <= 20)) return { text: 'ÎšÎ‘Î›Î— Î©Î¡Î‘', reason: 'Î™Î´Î±Î½Î¹ÎºÎ­Ï‚ ÏÏÎµÏ‚ Ï€Î¿Ï„Î¯ÏƒÎ¼Î±Ï„Î¿Ï‚', class: 'water-now', icon: 'bi-check-circle', shouldWater: true };
            return { text: 'Î•Î›Î•Î“ÎÎ¤Î• Î‘Î¡Î“ÎŸÎ¤Î•Î¡Î‘', reason: 'Î ÏÏ‰Î¯ Î® Î±Ï€ÏŒÎ³ÎµÏ…Î¼Î± ÎºÎ±Î»ÏÏ„ÎµÏÎ±', class: 'water-later', icon: 'bi-clock', shouldWater: false };
        }

        function displayForecast(aegina, mpralos) {
            const days = aegina.daily.time;
            let html = '<div class="d-flex flex-wrap justify-content-center">', optimalDay = null, optimalScore = -1;
            for (let i = 0; i < days.length; i++) {
                const date = new Date(days[i]);
                const ws = calculateWateringScore(aegina.daily, mpralos.daily, i);
                if (ws > optimalScore && i > 0) { optimalScore = ws; optimalDay = i; }
                const cardClass = i === optimalDay ? 'optimal' : (ws > 60 ? 'good' : (ws < 30 ? 'avoid' : ''));
                const w = getWeatherInfo(aegina.daily.weather_code[i]);
                html += `<div class="forecast-card ${cardClass}"><strong>${GREEK_DAYS[date.getDay()]}</strong><br><small>${date.getDate()}/${date.getMonth()+1}</small><br><i class="bi ${w.icon} fs-3"></i><br><span>${Math.round(aegina.daily.temperature_2m_max[i])}Â°/${Math.round(aegina.daily.temperature_2m_min[i])}Â°</span><br><small class="${aegina.daily.precipitation_probability_max[i]>50?'text-primary':''}"><i class="bi bi-droplet"></i> ${aegina.daily.precipitation_probability_max[i]}%</small><br>${i === optimalDay ? '<span class="badge bg-success">Î’Î­Î»Ï„Î¹ÏƒÏ„Î·</span>' : ''}</div>`;
            }
            html += '</div>';
            if (optimalDay !== null) {
                const od = new Date(days[optimalDay]);
                html += `<div class="alert alert-success mt-3 text-center"><i class="bi bi-calendar-check"></i> <strong>Î’Î­Î»Ï„Î¹ÏƒÏ„Î· Î·Î¼Î­ÏÎ± Ï€Î¿Ï„Î¯ÏƒÎ¼Î±Ï„Î¿Ï‚:</strong> ${GREEK_DAYS[od.getDay()]}, ${od.getDate()}/${od.getMonth()+1}</div>`;
            }
            document.getElementById('forecastSection').innerHTML = html;
        }

        function calculateWateringScore(a, m, i) {
            let s = 100;
            const pp = (a.precipitation_probability_max[i] + m.precipitation_probability_max[i]) / 2;
            const pr = (a.precipitation_sum[i] + m.precipitation_sum[i]) / 2;
            const tm = (a.temperature_2m_max[i] + m.temperature_2m_max[i]) / 2;
            if (pp > 70) s -= 50; else if (pp > 40) s -= 25;
            if (pr > 5) s -= 40; else if (pr > 1) s -= 20;
            if (tm > 38 || tm < 5) s -= 30; else if (tm > 33) s -= 15;
            if (tm >= 20 && tm <= 28) s += 10;
            return Math.max(0, Math.min(100, s));
        }

        function logTodayWeather(aegina, mpralos) {
            const today = new Date().toISOString().split('T')[0];
            const history = getHistory();
            const entry = createHistoryEntry(today, aegina, mpralos);
            const idx = history.findIndex(e => e.date === today);
            if (idx >= 0) history[idx] = entry; else history.unshift(entry);
            while (history.length > 365) history.pop();
            saveHistory(history);
            displayHistory(history);
        }

        function createHistoryEntry(date, aegina, mpralos) {
            const as = calculateDayScore(aegina.current), ms = calculateDayScore(mpralos.current);
            const aw = getWateringRecommendation(aegina), mw = getWateringRecommendation(mpralos);
            return { date, aegina: { temp: aegina.current.temperature_2m, humidity: aegina.current.relative_humidity_2m, precip: aegina.current.precipitation, weatherCode: aegina.current.weather_code, score: as, shouldWater: aw.shouldWater }, mpralos: { temp: mpralos.current.temperature_2m, humidity: mpralos.current.relative_humidity_2m, precip: mpralos.current.precipitation, weatherCode: mpralos.current.weather_code, score: ms, shouldWater: mw.shouldWater }, bestLocation: as > ms ? 'aegina' : (ms > as ? 'mpralos' : 'tie') };
        }

        function getHistory() { try { return JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]'); } catch { return []; } }
        function saveHistory(h) { localStorage.setItem(HISTORY_KEY, JSON.stringify(h)); }
        function loadHistory() { displayHistory(getHistory()); }

        function displayHistory(history) {
            const tbody = document.getElementById('historyBody');
            if (!history.length) { tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î­Ï‚</td></tr>'; return; }
            tbody.innerHTML = history.slice(0, 30).map(e => {
                const d = new Date(e.date), aw = getWeatherInfo(e.aegina.weatherCode), mw = getWeatherInfo(e.mpralos.weatherCode);
                const ar = getDayRating((e.aegina.score + e.mpralos.score) / 2);
                const bl = e.bestLocation === 'aegina' ? ['Î‘Î¯Î³Î¹Î½Î±', 'best-aegina'] : (e.bestLocation === 'mpralos' ? ['ÎœÏ€ÏÎ¬Î»Î¿Ï‚', 'best-mpralos'] : ['Î™ÏƒÎ¿Ï€Î±Î»Î¯Î±', 'best-tie']);
                const sw = e.aegina.shouldWater || e.mpralos.shouldWater;
                return `<tr><td>${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()}</td><td><i class="bi ${aw.icon}"></i> ${Math.round(e.aegina.temp)}Â°C<br><small class="text-muted">${aw.text}</small></td><td><i class="bi ${mw.icon}"></i> ${Math.round(e.mpralos.temp)}Â°C<br><small class="text-muted">${mw.text}</small></td><td class="${bl[1]}">${bl[0]}</td><td><span class="day-rating ${ar.class}">${ar.text}</span></td><td class="${sw?'watering-yes':'watering-no'}"><i class="bi bi-${sw?'check':'x'}-circle"></i> ${sw?'ÎÎ±Î¹':'ÎŒÏ‡Î¹'}</td></tr>`;
            }).join('');
        }

        function updateStatistics() {
            const h = getHistory();
            if (!h.length) return;
            document.getElementById('aeginaStats').innerHTML = renderStats(calcStats(h, 'aegina'));
            document.getElementById('mpralosStats').innerHTML = renderStats(calcStats(h, 'mpralos'));
        }

        function calcStats(h, loc) {
            const d = h.map(x => x[loc]), sc = d.map(x => x.score), tp = d.map(x => x.temp);
            return { avgScore: Math.round(sc.reduce((a,b)=>a+b,0)/sc.length), bestScore: Math.max(...sc), worstScore: Math.min(...sc), avgTemp: Math.round(tp.reduce((a,b)=>a+b,0)/tp.length), maxTemp: Math.round(Math.max(...tp)), minTemp: Math.round(Math.min(...tp)), wateringDays: d.filter(x=>x.shouldWater).length, bestDays: h.filter(x=>x.bestLocation===loc).length, totalDays: h.length };
        }

        function renderStats(s) {
            return `<div class="stat-item"><span>ÎœÎ­ÏƒÎ· Î²Î±Î¸Î¼Î¿Î»Î¿Î³Î¯Î±:</span><strong>${s.avgScore}/100</strong></div><div class="stat-item"><span>ÎšÎ±Î»ÏÏ„ÎµÏÎ· Î·Î¼Î­ÏÎ±:</span><strong>${s.bestScore}/100</strong></div><div class="stat-item"><span>Î§ÎµÎ¹ÏÏŒÏ„ÎµÏÎ· Î·Î¼Î­ÏÎ±:</span><strong>${s.worstScore}/100</strong></div><div class="stat-item"><span>ÎœÎ­ÏƒÎ· Î¸ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î±:</span><strong>${s.avgTemp}Â°C</strong></div><div class="stat-item"><span>Î•ÏÏÎ¿Ï‚ Î¸ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î±Ï‚:</span><strong>${s.minTemp}Â°C - ${s.maxTemp}Â°C</strong></div><div class="stat-item"><span>Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿Ï„Î¯ÏƒÎ¼Î±Ï„Î¿Ï‚:</span><strong>${s.wateringDays}/${s.totalDays}</strong></div><div class="stat-item"><span>ÎšÎ±Î»ÏÏ„ÎµÏÎ· Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±:</span><strong>${s.bestDays}/${s.totalDays} Î·Î¼Î­ÏÎµÏ‚</strong></div>`;
        }

        function clearLog() { if (confirm('Î”Î¹Î±Î³ÏÎ±Ï†Î® Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÎ¿Ï;')) { localStorage.removeItem(HISTORY_KEY); loadHistory(); updateStatistics(); document.getElementById('aeginaStats').innerHTML = document.getElementById('mpralosStats').innerHTML = '<p class="text-muted">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î±</p>'; } }

        function exportLog() {
            const h = getHistory();
            if (!h.length) { alert('Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î±'); return; }
            let csv = 'Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±,Î‘Î¯Î³Î¹Î½Î± Î˜ÎµÏÎ¼,Î‘Î¯Î³Î¹Î½Î± Î¥Î³ÏÎ±ÏƒÎ¯Î±,Î‘Î¯Î³Î¹Î½Î± Î’Î±Î¸Î¼,ÎœÏ€ÏÎ¬Î»Î¿Ï‚ Î˜ÎµÏÎ¼,ÎœÏ€ÏÎ¬Î»Î¿Ï‚ Î¥Î³ÏÎ±ÏƒÎ¯Î±,ÎœÏ€ÏÎ¬Î»Î¿Ï‚ Î’Î±Î¸Î¼,ÎšÎ±Î»ÏÏ„ÎµÏÎ·,Î ÏŒÏ„Î¹ÏƒÎ¼Î±\n';
            h.forEach(e => { csv += `${e.date},${e.aegina.temp},${e.aegina.humidity},${e.aegina.score},${e.mpralos.temp},${e.mpralos.humidity},${e.mpralos.score},${e.bestLocation},${e.aegina.shouldWater||e.mpralos.shouldWater?'ÎÎ±Î¹':'ÎŒÏ‡Î¹'}\n`; });
            const link = document.createElement('a'); link.href = URL.createObjectURL(new Blob([csv], {type:'text/csv;charset=utf-8;'})); link.download = `weather_log_${new Date().toISOString().split('T')[0]}.csv`; link.click();
        }
    </script>
</body>
</html>
